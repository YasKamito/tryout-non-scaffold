# もう少し複雑なモデルの関連を作れるようになる

```
irb(main):018:0> Blog.all
  Blog Load (0.2ms)  SELECT "blogs".* FROM "blogs"
+----+--------------------------------+-------------------------+-------------------------+
| id | title                          | created_at              | updated_at              |
+----+--------------------------------+-------------------------+-------------------------+
| 1  | ねこがすき！にゃんにゃんブログ | 2017-09-19 12:45:34 UTC | 2017-09-19 12:45:34 UTC |
| 2  | いぬがすき！わんわんブログ     | 2017-09-19 12:46:55 UTC | 2017-09-19 12:46:55 UTC |
| 3  | つまがすき！いとうさんブログ   | 2017-09-19 12:47:27 UTC | 2017-09-19 12:47:27 UTC |
+----+--------------------------------+-------------------------+-------------------------+
3 rows in set
irb(main):019:0> Entry.all
  Entry Load (0.2ms)  SELECT "entries".* FROM "entries"
+----+----------------------+------------------------+-------------------------+-------------------------+---------+
| id | title                | body                   | created_at              | updated_at              | blog_id |
+----+----------------------+------------------------+-------------------------+-------------------------+---------+
| 1  | はじめてのエントリー | はじめまして！         | 2017-09-19 11:52:44 UTC | 2017-09-19 12:55:40 UTC | 1       |
| 2  | ２番目のエントリー   | お久しぶりです！       | 2017-09-19 11:55:43 UTC | 2017-09-19 12:56:17 UTC | 1       |
| 3  | ３番目のエントリー   | もうくじけました・・・ | 2017-09-19 11:56:08 UTC | 2017-09-19 12:56:35 UTC | 3       |
+----+----------------------+------------------------+-------------------------+-------------------------+---------+
3 rows in set
irb(main):020:0> Comment.all
  Comment Load (0.2ms)  SELECT "comments".* FROM "comments"
+----+------------------------+------------+----------+-------------------------+-------------------------+
| id | body                   | status     | entry_id | created_at              | updated_at              |
+----+------------------------+------------+----------+-------------------------+-------------------------+
| 1  | てすてす               | approved   | 1        | 2017-09-19 11:54:33 UTC | 2017-09-19 11:54:33 UTC |
| 2  | ねこはかわいいですよね | unapproved | 1        | 2017-09-19 11:55:05 UTC | 2017-09-19 13:01:35 UTC |
| 3  | 例のねこについて       | approved   | 2        | 2017-09-19 11:56:35 UTC | 2017-09-19 13:35:15 UTC |
| 4  | こんにちはこんにちは！ | approved   | 3        | 2017-09-19 13:03:58 UTC | 2017-09-19 13:03:58 UTC |
+----+------------------------+------------+----------+-------------------------+-------------------------+
4 rows in set
irb(main):021:0> Comment.joins(:entry).where(entries: { blog_id: 1} )
  Comment Load (0.1ms)  SELECT "comments".* FROM "comments" INNER JOIN "entries" ON "entries"."id" = "comments"."entry_id" WHERE "entries"."blog_id" = ?  [["blog_id", 1]]
+----+------------------------+------------+----------+-------------------------+-------------------------+
| id | body                   | status     | entry_id | created_at              | updated_at              |
+----+------------------------+------------+----------+-------------------------+-------------------------+
| 1  | てすてす               | approved   | 1        | 2017-09-19 11:54:33 UTC | 2017-09-19 11:54:33 UTC |
| 2  | ねこはかわいいですよね | unapproved | 1        | 2017-09-19 11:55:05 UTC | 2017-09-19 13:01:35 UTC |
| 3  | 例のねこについて       | approved   | 2        | 2017-09-19 11:56:35 UTC | 2017-09-19 13:35:15 UTC |
+----+------------------------+------------+----------+-------------------------+-------------------------+
3 rows in set

irb(main):029:0> Blog.eager_load(:entries).where(entries: { blog_id: nil})
  SQL (0.3ms)  SELECT "blogs"."id" AS t0_r0, "blogs"."title" AS t0_r1, "blogs"."created_at" AS t0_r2, "blogs"."updated_at" AS t0_r3, "entries"."id" AS t1_r0, "entries"."title" AS t1_r1, "entries"."body" AS t1_r2, "entries"."created_at" AS t1_r3, "entries"."updated_at" AS t1_r4, "entries"."blog_id" AS t1_r5 FROM "blogs" LEFT OUTER JOIN "entries" ON "entries"."blog_id" = "blogs"."id" WHERE "entries"."blog_id" IS NULL
+----+----------------------------+-------------------------+-------------------------+
| id | title                      | created_at              | updated_at              |
+----+----------------------------+-------------------------+-------------------------+
| 2  | いぬがすき！わんわんブログ | 2017-09-19 12:46:55 UTC | 2017-09-19 12:46:55 UTC |
+----+----------------------------+-------------------------+-------------------------+
1 row in set

irb(main):047:0> Blog.joins({:entries => :comments}).where(:comments => { :status => "unapproved" })
  Blog Load (0.2ms)  SELECT "blogs".* FROM "blogs" INNER JOIN "entries" ON "entries"."blog_id" = "blogs"."id" INNER JOIN "comments" ON "comments"."entry_id" = "entries"."id" WHERE "comments"."status" = ?  [["status", "unapproved"]]
+----+--------------------------------+-------------------------+-------------------------+
| id | title                          | created_at              | updated_at              |
+----+--------------------------------+-------------------------+-------------------------+
| 1  | ねこがすき！にゃんにゃんブログ | 2017-09-19 12:45:34 UTC | 2017-09-19 12:45:34 UTC |
+----+--------------------------------+-------------------------+-------------------------+
1 row in set

```
